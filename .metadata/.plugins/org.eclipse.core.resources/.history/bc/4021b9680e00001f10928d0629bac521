/*
 * Controller.c
 *
 *  Created on: Apr 22, 2024
 *      Author: emper
 */

#include "Encoder.h"
#include "Controller.h"
#include "main.h"

void PIDPositionController_Init(PIDStructureTypeDef* PID,float Kp ,float Ki , float Kd)	// Initialize PID Variable
{
	PID->Kp = Kp;
	PID->Ki = Ki;
	PID->Kd = Kd;
	PID->Error = 0;
	PID->Error_1 = 0;
	PID->Error_2 = 0;
	PID->Command = 0;
	PID->Command_1 = 0;
}

void PIDController_Command(PIDStructureTypeDef* PID,QEIStructureTypeDef* Feedback,float setpoint)
{
	PID->Error = setpoint - Feedback->LinearPosition;
	/* y[n] = y[n-1] + A0 * x[n] + A1 * x[n-1] + A2 * x[n-2]
	A0 = Kp + Ki + Kd;
	A1 = -Kp - (2 * Kd);
	A2 = Kd; */

	PID->Command = PID->Command_1 + (PID->Kp + PID->Ki + PID->Kd)*PID->Error - (+PID->Kp+(2*PID->Kd))*PID->Error_1 + PID->Kd*PID->Error_2;
}
