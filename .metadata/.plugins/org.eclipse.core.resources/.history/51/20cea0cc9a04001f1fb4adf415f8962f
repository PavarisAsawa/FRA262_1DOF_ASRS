/*
 * Joystick.c
 *
 *  Created on: Apr 27, 2024
 *      Author: emper
 */

#include "main.h"
#include "Joystick.h"

/*		PIN - LIST		*/
/*
	A	:	PB10
	B	:	PB4
	C	:	PB5
	D	:	PA10
*/

void Joystick_UpdateValue(JoystickStructureTypeDef* joystick)
{
	static uint16_t tempSTATE[4] = {1,1,1,1};

	/* Update OLD Value */
//	if(HAL_GPIO_ReadPin(GPIOB, GPIO_PIN_10) == 0)	tempSTATE[A] = 0;		//	IF SWITCH [A] PUSHED
//	if(HAL_GPIO_ReadPin(GPIOB, GPIO_PIN_4) == 0)	tempSTATE[B] = 0;		//	IF SWITCH [B] PUSHED
//	if(HAL_GPIO_ReadPin(GPIOB, GPIO_PIN_5) == 0)	tempSTATE[C] = 0;		//	IF SWITCH [C] PUSHED
//	if(HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_10) == 0)	tempSTATE[D] = 0;		//	IF SWITCH [D] PUSHED
//
//	if(!tempSTATE[A] && HAL_GPIO_ReadPin(GPIOB, GPIO_PIN_10))	joystick->PIN[A] = 1;
//	else joystick->PIN[A] = 0;
//
//	if(!tempSTATE[B] && HAL_GPIO_ReadPin(GPIOB, GPIO_PIN_4))	joystick->PIN[B] = 1;
//	else joystick->PIN[B] = 0;
//
//	if(!tempSTATE[C] && HAL_GPIO_ReadPin(GPIOB, GPIO_PIN_5))	joystick->PIN[C] = 1;
//	else joystick->PIN[C] = 0;
//
//	if(!tempSTATE[D] && HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_10))	joystick->PIN[D] = 1;
//	else joystick->PIN[D] = 0;

	 if(HAL_GPIO_ReadPin(GPIOB, GPIO_PIN_10) == 0) {
	        tempSTATE[A] = 0; // Button is pressed
	    } else if (tempSTATE[A] == 0) { // Falling edge detected
	        joystick->PIN[A] = 1;  // Set joystick PIN on falling edge
	        tempSTATE[A] = 1;      // Reset the state to not pressed
	    } else {
	        joystick->PIN[A] = 0;  // Ensure PIN is reset outside of falling edge
	    }

	    // Button B
	    if(HAL_GPIO_ReadPin(GPIOB, GPIO_PIN_4) == 0) {
	        tempSTATE[B] = 0;
	    } else if (tempSTATE[B] == 0) {
	        joystick->PIN[B] = 1;
	        tempSTATE[B] = 1;
	    } else {
	        joystick->PIN[B] = 0;
	    }

	    // Button C
	    if(HAL_GPIO_ReadPin(GPIOB, GPIO_PIN_5) == 0) {
	        tempSTATE[C] = 0;
	    } else if (tempSTATE[C] == 0) {
	        joystick->PIN[C] = 1;
	        tempSTATE[C] = 1;
	    } else {
	        joystick->PIN[C] = 0;
	    }

	    // Button D
	    if(HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_10) == 0) {
	        tempSTATE[D] = 0;
	    } else if (tempSTATE[D] == 0) {
	        joystick->PIN[D] = 1;
	        tempSTATE[D] = 1;
	    } else {
	        joystick->PIN[D] = 0;
	    }
}
