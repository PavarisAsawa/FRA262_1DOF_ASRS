/*
 * ModeHandler.c
 *
 *  Created on: Apr 27, 2024
 *      Author: emper
 */

#include "ModeHandler.h"
#include "Controller.h"

float MAX_SPEED = 200;
extern TIM_HandleTypeDef htim4;

void Jog_mode(JoystickStructureTypeDef *joystick , QEIStructureTypeDef *QEI)
{

	Joystick_UpdateValue(joystick,QEI);
	if(joystick->Y < 2146 && joystick->Y >1950)
	{
		Motor_Control(10);
	}
	else if(joystick->Y > 2146)
	{
		if( (uint16_t)(((joystick->Y-2000)*MAX_SPEED)/2000) > 10) Motor_Control((uint16_t)(((joystick->Y-2000)*MAX_SPEED)/2000));
		else Motor_Control(10);
	}
	else if(joystick->Y < 1950)
	{
		Motor_Control(-(uint16_t)(((1975-joystick->Y)*MAX_SPEED)/1975));
	}

}

void Point_mode(PIDStructureTypeDef *PID , QEIStructureTypeDef *QEI,float setpoint)
{
	PIDControllerPosition_Command(PID, QEI, setpoint);
	Motor_Control(PID->Command);
}


